{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "version": "1.0.0",
  "projectName": "Retune",
  "projectDescription": "webOS application that transforms Plex media libraries into simulated linear television channels",
  "targetPlatform": "webOS 4.0+ (Chromium 68)",
  
  "_prioritySemantics": "Priority indicates implementation order. Lower numbers = implement first. Priority 1 modules have no dependencies. Same-priority modules can be implemented in parallel.",

  "modules": [
    {
      "id": "plex-auth",
      "name": "Plex Authentication",
      "path": "src/modules/plex/auth",
      "primaryFile": "PlexAuth.ts",
      "dependsOn": [],
      "provides": [
        "IPlexAuth",
        "PlexAuthConfig",
        "PlexPinRequest",
        "PlexAuthToken",
        "PlexAuthData"
      ],
      "consumes": [],
      "priority": 1,
      "estimatedComplexity": "medium",
      "estimatedLoC": 350,
      "parallelizable": true,
      "description": "Handles PIN-based OAuth flow with plex.tv, token storage/validation, and credential management."
    },
    {
      "id": "plex-server-discovery",
      "name": "Plex Server Discovery",
      "path": "src/modules/plex/discovery",
      "primaryFile": "PlexServerDiscovery.ts",
      "dependsOn": ["plex-auth"],
      "provides": [
        "IPlexServerDiscovery",
        "PlexServer",
        "PlexConnection"
      ],
      "consumes": ["IPlexAuth"],
      "priority": 2,
      "estimatedComplexity": "medium",
      "estimatedLoC": 280,
      "parallelizable": false,
      "description": "Fetches available servers for authenticated user, tests connections, and manages server selection."
    },
    {
      "id": "plex-library",
      "name": "Plex Library Access",
      "path": "src/modules/plex/library",
      "primaryFile": "PlexLibrary.ts",
      "dependsOn": ["plex-auth", "plex-server-discovery"],
      "provides": [
        "IPlexLibrary",
        "PlexLibrary",
        "PlexMediaItem",
        "PlexMediaFile",
        "PlexStream",
        "LibraryQueryOptions",
        "SearchOptions"
      ],
      "consumes": ["IPlexAuth", "IPlexServerDiscovery"],
      "priority": 3,
      "estimatedComplexity": "high",
      "estimatedLoC": 500,
      "parallelizable": false,
      "description": "Enumerates libraries, retrieves content metadata, handles TV show hierarchies, and manages image URLs with token injection."
    },
    {
      "id": "plex-stream-resolver",
      "name": "Plex Stream Resolver",
      "path": "src/modules/plex/stream",
      "primaryFile": "PlexStreamResolver.ts",
      "dependsOn": ["plex-auth", "plex-server-discovery"],
      "provides": [
        "IPlexStreamResolver",
        "StreamRequest",
        "StreamDecision",
        "HlsOptions"
      ],
      "consumes": ["IPlexAuth", "IPlexServerDiscovery"],
      "priority": 3,
      "estimatedComplexity": "medium",
      "estimatedLoC": 320,
      "parallelizable": true,
      "description": "Resolves playback URLs from Plex, handles direct play vs transcoding decisions, manages playback sessions."
    },
    {
      "id": "channel-manager",
      "name": "Channel Configuration Manager",
      "path": "src/modules/scheduler/channel-manager",
      "primaryFile": "ChannelManager.ts",
      "dependsOn": ["plex-library"],
      "provides": [
        "IChannelManager",
        "ChannelConfig",
        "ChannelContentSource",
        "ResolvedChannelContent",
        "ResolvedContentItem",
        "PlaybackMode",
        "ContentFilter",
        "SortOrder"
      ],
      "consumes": ["IPlexLibrary"],
      "priority": 4,
      "estimatedComplexity": "high",
      "estimatedLoC": 600,
      "parallelizable": false,
      "description": "Manages channel CRUD operations, resolves content from various Plex sources, persists configurations to localStorage."
    },
    {
      "id": "channel-scheduler",
      "name": "Channel Scheduler",
      "path": "src/modules/scheduler/scheduler",
      "primaryFile": "ChannelScheduler.ts",
      "dependsOn": ["channel-manager"],
      "provides": [
        "IChannelScheduler",
        "IShuffleGenerator",
        "ScheduleConfig",
        "ScheduledProgram",
        "ScheduleWindow",
        "SchedulerState",
        "ScheduleIndex"
      ],
      "consumes": ["IChannelManager", "ResolvedChannelContent"],
      "priority": 5,
      "estimatedComplexity": "high",
      "estimatedLoC": 550,
      "parallelizable": false,
      "description": "Generates deterministic schedules based on wall-clock time. Core algorithm uses modular arithmetic for infinite looping with O(log n) program lookup."
    },
    {
      "id": "video-player",
      "name": "Video Player Abstraction",
      "path": "src/modules/player",
      "primaryFile": "VideoPlayer.ts",
      "dependsOn": ["plex-stream-resolver"],
      "provides": [
        "IVideoPlayer",
        "VideoPlayerConfig",
        "StreamDescriptor",
        "MediaMetadata",
        "SubtitleTrack",
        "AudioTrack",
        "PlaybackState",
        "PlayerStatus",
        "PlaybackError"
      ],
      "consumes": ["IPlexStreamResolver", "StreamDecision"],
      "priority": 4,
      "estimatedComplexity": "high",
      "estimatedLoC": 480,
      "parallelizable": true,
      "description": "Abstracts HTML5 video element for webOS, handles HLS/direct playback, subtitle/audio track management, and error recovery."
    },
    {
      "id": "navigation",
      "name": "Navigation & Remote Control",
      "path": "src/modules/navigation",
      "primaryFile": "NavigationManager.ts",
      "dependsOn": [],
      "provides": [
        "INavigationManager",
        "IFocusManager",
        "NavigationConfig",
        "RemoteButton",
        "KeyEvent",
        "Screen",
        "NavigationState",
        "FocusableElement",
        "FocusGroup"
      ],
      "consumes": [],
      "priority": 2,
      "estimatedComplexity": "high",
      "estimatedLoC": 520,
      "parallelizable": true,
      "description": "Handles LG remote key events, manages focus across screens, implements spatial navigation and focus memory."
    },
    {
      "id": "epg-ui",
      "name": "EPG Component",
      "path": "src/modules/ui/epg",
      "primaryFile": "EPGComponent.ts",
      "dependsOn": ["navigation", "channel-scheduler", "channel-manager"],
      "provides": [
        "IEPGComponent",
        "IEPGInfoPanel",
        "EPGConfig",
        "EPGState",
        "EPGFocusPosition",
        "EPGChannelRow",
        "EPGProgramCell"
      ],
      "consumes": ["INavigationManager", "IChannelScheduler", "IChannelManager"],
      "priority": 6,
      "estimatedComplexity": "high",
      "estimatedLoC": 700,
      "parallelizable": false,
      "description": "Renders virtualized program guide grid, handles D-pad navigation within grid, manages current time indicator."
    },
    {
      "id": "app-lifecycle",
      "name": "Application Lifecycle",
      "path": "src/modules/lifecycle",
      "primaryFile": "AppLifecycle.ts",
      "dependsOn": [],
      "provides": [
        "IAppLifecycle",
        "IErrorRecovery",
        "AppLifecycleState",
        "AppPhase",
        "ConnectionStatus",
        "AppError",
        "AppErrorType",
        "PersistentState",
        "UserPreferences"
      ],
      "consumes": [],
      "priority": 1,
      "estimatedComplexity": "medium",
      "estimatedLoC": 400,
      "parallelizable": true,
      "description": "Manages webOS app lifecycle events, state persistence, network monitoring, memory management, and error recovery strategies."
    },
    {
      "id": "app-orchestrator",
      "name": "Application Orchestrator",
      "path": "src",
      "primaryFile": "Orchestrator.ts",
      "dependsOn": [
        "app-lifecycle",
        "navigation",
        "plex-auth",
        "plex-library",
        "channel-manager",
        "channel-scheduler",
        "video-player",
        "epg-ui"
      ],
      "provides": [
        "IAppOrchestrator",
        "ModuleStatus"
      ],
      "consumes": [
        "IAppLifecycle",
        "INavigationManager",
        "IPlexAuth",
        "IPlexLibrary",
        "IChannelManager",
        "IChannelScheduler",
        "IVideoPlayer",
        "IEPGComponent"
      ],
      "priority": 7,
      "estimatedComplexity": "medium",
      "estimatedLoC": 350,
      "parallelizable": false,
      "description": "Coordinates all modules, handles initialization sequence, sets up inter-module event bindings, manages application startup and shutdown."
    },
    {
      "id": "event-emitter",
      "name": "Event Emitter Utility",
      "path": "src/utils",
      "primaryFile": "EventEmitter.ts",
      "dependsOn": [],
      "provides": [
        "EventEmitter",
        "EventHandler"
      ],
      "consumes": [],
      "priority": 1,
      "estimatedComplexity": "low",
      "estimatedLoC": 80,
      "parallelizable": true,
      "description": "Typed event emitter utility used by all modules for inter-module communication."
    }
  ],

  "implementationPhases": [
    {
      "phase": 1,
      "name": "Core Infrastructure",
      "modules": ["event-emitter", "plex-auth", "app-lifecycle", "navigation"],
      "milestone": "Basic app shell with authentication flow and remote control handling. User can sign in with Plex and app responds to remote input.",
      "estimatedDays": 3
    },
    {
      "phase": 2,
      "name": "Plex Integration",
      "modules": ["plex-server-discovery", "plex-library", "plex-stream-resolver"],
      "milestone": "Full Plex API integration complete. App can discover servers, browse libraries, and resolve playback URLs.",
      "estimatedDays": 4
    },
    {
      "phase": 3,
      "name": "Core Playback (MVP)",
      "modules": ["video-player", "channel-manager", "channel-scheduler"],
      "milestone": "MVP functional. User can create channels, and content plays according to deterministic schedule with channel switching.",
      "estimatedDays": 5
    },
    {
      "phase": 4,
      "name": "Full EPG Experience",
      "modules": ["epg-ui"],
      "milestone": "Complete EPG grid with virtualized rendering, D-pad navigation, and program selection working.",
      "estimatedDays": 4
    },
    {
      "phase": 5,
      "name": "Integration & Polish",
      "modules": ["app-orchestrator"],
      "milestone": "All modules integrated and communicating. Error recovery flows implemented. Ready for extended testing.",
      "estimatedDays": 3
    }
  ],

  "sharedDependencies": [
    {
      "name": "TypeScript",
      "version": "5.x",
      "purpose": "Language"
    },
    {
      "name": "esbuild",
      "version": "0.19+",
      "purpose": "Build/bundling"
    }
  ],

  "criticalPaths": [
    {
      "path": ["plex-auth", "plex-server-discovery", "plex-library", "channel-manager", "channel-scheduler"],
      "description": "Authentication → Library → Scheduling pipeline. Blocking dependency chain for core playback."
    },
    {
      "path": ["navigation", "epg-ui"],
      "description": "Focus management → EPG rendering. Required for complete UI experience."
    }
  ]
}
